# Reference

**Note**: We're only documenting API scheme, without adding base path. It may vary depending on your configuration.

## API Versioning

Learndesk exposes different versions of the API. You can specify it by prefixing the endpoint by `v{version_number}/`.
Omitting it will make you use the latest stable version of the API. Using a discontinued version of the API will return
400 Bad Request.

| version | status |
|----|----|
| 1 | soon:tm: |

## Errors

The API may return errors, and those errors are sent in the same format all the time.

| field | type | description |
| ----- | ----- | ----- |
| status | number | HTTP status of the request |
| message | string | error message associated with the code |

Note: We'll only document possible HTTP return codes, but not the codes it may return.

## Rate limiting

To prevent abuses, the API have rate limits in place. As a good practice, **do not hardcode rate limits in your
application**! Make sure to properly parse headers and make sure you won't hit limits too often. Doing so may result
in IP bans, so be careful!

## Authentication

### Tokens

Authentication is an extremely important part of an application, as it ensures your data is kept safe. As we provide
Two Factor Authentication (2FA or MFA), we designed our authentication flow to be secure and aware of this factor in
our token structure.

Here is how our tokens are structured:
```
OTQ3NjI0OTI5MjM3NDgzNTI.NjY2NDIwNjk.dGhpcyBpcyBhIHZlcnkgc2VjdXJlIHNpZ25hdHVyZSE
----------------------- ----------- -------------------------------------------
Account ID              Generation  Signature of everything that preceeds
                        Date
```

MFA tokens are just prefixed with `mfa.` (both in raw token and in signature). The only case where a non-MFA token is
allowed to perform requests to the API on behalf of an user that has MFA enabled is to finalize authentication.

### Authorization

You must be authenticated to perform request to the API (except while logging in). For all authentication types,
this is performed with the `Authorization` HTTP header
```
Authorization: TOKEN
```

## Optional and nullable field

Fields that are optional (may be omitted in payload) are suffixed with a question mark, and fields that can contain
`null` have their type prefixed with a question mark.

| field | type |
|----|----|
| optional? | string |
| nullable | ?string |
| optional_and_nullable? | ?string |

## Types

### Snowflakes

We use [Twitter's Snowflakes](https://github.com/twitter-archive/snowflake/tree/snowflake-2010) format to generate
unique IDs. Those are guaranteed to be unique across all resources. Because Snowflakes are up to 64 bits in size the
API serves them as strings to prevent [integer overflows](https://en.wikipedia.org/wiki/Integer_overflow).

#### Snowflake structure (LTR)

| bits | description | retrieval |
|----|----|----|
63 to 22 | milliseconds since Learndesk epoch, the first second of 2019 (1546300800000) | (snowflake >> 22) + 1546300800000 |
21 to 17 | internal worker id | (snowflake & 0x3E0000) >> 17 |
16 to 12 | internal process id | (snowflake & 0x1F000) >> 12 |
11 to 0 | increment, gets incremented every time an ID is generated by that process | snowflake & 0xFFF |

### User Identifier

Users have multiple ways to be identified, and all of those ways are aggregated and called User Identifier. An User
Identifier can be:
 - A [snowflake](#snowflakes)
 - An email address
 - An username

### User Flags

User flags are internally used to save attributes about the users, like permissions or badges.

| value | description |
|----|----|
| 0 | none |
| 1 << 0 | Learndesk Staff |
| 1 << 1 | Teacher |
| 1 << 2 | Contributor |
| 1 << 3 | Bug Hunter |

### Avatar Data

Avatar data is a [Data URI scheme](https://en.wikipedia.org/wiki/Data_URI_scheme), that looks like:
```
data:image/jpeg;base64,JPEG_DATA_ENCODED
```
Supported formats are JPG, PNG and GIFs. If an animated avatar is received, it'll be cropped to the 1st frame. EXIF
data will be wiped.
